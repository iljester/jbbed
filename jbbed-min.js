/**
 * jbbed
 * @author iljester <thejester72@gmail.com>
 * @website https://github.com/iljester, https://www.iljester.com
 * @package jbbed editor plugin
 * (c) 2024 
 * @version 1.0beta
 */

!function(e){e.fn.jbbedMu=function(t={}){e(this).each((function(){t.editorID=Jbbed.randomId(Math.random(),5),e(this).jbbed(t)}))},e.fn.jbbed=function(t={}){e(this).addClass("jbbed-editor"),void 0===e(this).attr("id")||void 0!==t.editorID&&0!==t.editorID.length||(t.editorID=btoa(e(this).selector).replace(/[^\w]+/,"").toLowerCase()),void 0===e(this).attr("id")&&void 0!==t.editorID&&t.editorID.length>0&&e(this).attr("id",t.editorID);const s=new Jbbed(e(this),t),i=s.frame,a=i.main,l=i.preview,n=i.buttons;if(e(a).insertBefore(this),e(a).append(this),e(n).insertBefore(this),!1!==s.params.themeArgs.style){let t="jbbed-"+s.params.themeArgs.style;e(this).closest("#"+a.id).addClass(t+" jbbed-template"),e(s.styleTheme).insertAfter("#jbbed-css")}!1!==s.params.themeArgs.icons&&e(s.styleIcons).insertBefore("#jbbed-css"),e(l).insertAfter(this),s.buttons(),s.fullscreen(),s.preview(),s.textarea()}}(jQuery);class Jbbed{ID="";editor;params={};frame={};allowed=[];allButtons=[];buttonLocalized={};video;styleTheme=!1;styleIcons;static defaults={editorID:"",themeArgs:{style:"classic",icons:"jbbicon/css/jbbicon",dirUri:""},bars:{1:["b","i","u","s","#","link","img","vid","#","ol","ul","li","#","quote","code"],2:["size","font","color","h","#","alignleft","aligncenter","alignright","#","hr","spoiler","#","smileys","jsf","#","clear"]},barArgs:{keepDefault:!1,selectiveRemove:["script","iframe"],tiny:!1},single:["hr","img","smileys","vid","jsf"],select:{size:["--:0",10,12,14,16,18,20,22,24,26,28,30],font:["--:0","Arial","Times New Roman","Lucida Sans","Roboto","Monospace","Courier","Helvetica","Georgia"],color:["--:0","Black:#000000","Grey:#808080","Lightgrey:#d3d3d3","Blue:#0000ff","Lightblue:#add8e6","Green:#008000","Lightgreen:#90ee90","Purple:#800080","Violet:#ee82ee","Pink:#ffc0cb","Brown:#a52a2a","Saddlebrown:#8b4513","Red:#ff0000","Orange:#ffa500","Yellow:#ffff00","White:#ffffff"],h:["--:0","H1:1","H2:2","H3:3","H4:4","H5:5","H6:6"]},sizeUnit:"px",modal:["size","color","font","h"],modalArgs:{preview:!0,previewSentence:"The quick brown fox jumps over the lazy dog",previewBgColor:"theme",previewTextColor:"theme",palette:!1,keepDefault:!0},textareaArgs:{font:"monospace",cols:50,rows:20,width:"100%",height:"500px",indent:!0},previewArgs:{font:"sans-serif",width:"100%",height:"500px",contentWrapP:["blockquote","div"],noWrapP:["ul","ol","h1","h2","h3","h4","h5","h6","blockquote","div"],noTagIntoTag:["strong","u","i","spoiler","link"]},spoilerArgs:{className:"",buttonHide:"Hide",buttonShow:"Spoiler",slide:400},jsfPlay:{output:"all",theme:"dark"},video:{youtube:[560,315,0],rumble:[640,360]},tagTranslate:{size:["span",'style="font-size:$1;"',"[0-9]+(px|em|rem|pt|%)"],font:["span",'style="font-family:$1;"',"[a-zA-Z0-9\\s]+"],color:["span",'style="color:$1;"',"[a-fA-F0-9#]+"],link:["a",'href="$1"',"[^<>\\]\\[\\s]+"],img:["img",'src="$1"',"[^<>\\s]+"],b:["strong",""],i:["em","",""],quote:["blockquote","",""],code:["pre","",""],aligncenter:["p",'style="text-align:center;"',""],alignleft:["p",'style="text-align:left;"',""],alignright:["p",'style="text-align:right;"',""],alignjustify:["p",'style="text-align:justify;"',""],spoiler:["div",'style="display:none"',""]},smileys:!0,fullscreen:!0,localizeButtons:{b:["label:_B","title:Bold","className:jbbicon-b jbbicon"],i:["label:_I","title:Italic","className:jbbicon-i jbbicon"],u:["label:_U","title:Underline","className:jbbicon-u jbbicon"],s:["label:_S","title:Strike","className:jbbicon-s2 jbbicon"],link:["label:_Link","title:Link","className:jbbicon-link jbbicon"],img:["label:_Img","title:Image","className:jbbicon-img jbbicon"],vid:["label:_Video","title:Video","className:jbbicon-vid jbbicon"],ul:["label:_UL","title:Unordered List","className:jbbicon-ul jbbicon"],ol:["label:_OL","title:Ordered List","className:jbbicon-ol jbbicon"],li:["label:_Li","title:List Item","className:jbbicon-li jbbicon"],code:["label:_Code","title:Code","className:jbbicon-code jbbicon"],quote:["label:_Cite","title:Cite","className:jbbicon-quote jbbicon"],clear:["label:_Trash","title:Trash","className:jbbicon-trash jbbicon"],hr:["label:_Line","title:Line","className:jbbicon-hr jbbicon"],aligncenter:["label:_AlignCenter","title:Align Center","className:jbbicon-aligncenter jbbicon"],alignleft:["label:_AlignLeft","title:Align Left","className:jbbicon-alignleft jbbicon"],alignright:["label:_AlignRight","title:Align Right","className:jbbicon-alignright jbbicon"],alignjustify:["label:_AlignJustify","title:Align Justify","className:jbbicon-alignjustify jbbicon"],size:["label:_Size","title:Size","className:jbbicon-size jbbicon"],font:["label:_Font","title:Font","className:jbbicon-font1 jbbicon"],h:["label:_Head","title:Head","className:jbbicon-head jbbicon"],color:["label:_Color","title:Color","className:jbbicon-palette3 jbbicon"],edit:["label:_Edit","title:Edit","className:jbbicon-edit jbbicon"],preview:["label:_Preview","title:Preview","className:jbbicon-preview jbbicon"],ok:["label:_OK","title:Ok","className:jbbicon-check jbbicon"],no:["label:_NO","title:No","className:jbbicon-close jbbicon"],smileys:["label:_Smileys","title:Smileys","className:jbbicon-emoticon jbbicon"],spoiler:["label:_Spoiler","title:Spoiler","className:jbbicon-spoiler jbbicon"],jsf:["label:_JsFiddle","title:JsFiddle","className:jbbicon-jsf jbbicon"],fullscreen:["label:_Fullscreen","title:Fullscreen","className:jbbicon-fullscreen jbbicon"]},localizeMessages:{link:"Insert an url or email address:",vid:"Insert a video ($1):",img:"Insert an image url:",jsf:"Insert link of your fiddle",clear:"Attention! You are about to delete your work! Are you sure?"}};static tinyBar=["b","i","link","img","ul","ol","li","quote","hr","spoiler","clear"];static sizeUnits=["px","pt","em","rem","%"];constructor(e,t){this.editor=e,this.params=t,this.parseValues(),this.ID=this.params.editorID,this.frames(),this.loadTheme(),this.loadIcons(),this.allowedTags()}frames(){const e=this.ID;this.frame.main=Jbbed.createElement("div",{cls:"jbbed-container",id:"container-"+e}),this.frame.buttons=Jbbed.createElement("div",{cls:"jbbed-buttons-container",id:"buttons-container-"+e}),this.frame.fullscreen=Jbbed.createElement("div",{cls:"jbbed-fullscreen-container",id:"fullscreen-container-"+e}),this.frame.tab=Jbbed.createElement("ul",{cls:"jbbed-tab-editor",id:"tab-editor-"+e}),this.frame.preview=Jbbed.createElement("div",{cls:"jbbed-preview",id:"preview-container-"+e,css:"display:none"})}parseValues(){const e=this.params,t=Jbbed.defaults;for(const s in t)void 0===e[s]&&(e[s]=t[s]);if(e.themeArgs=Jbbed.compare(e.themeArgs,t.themeArgs,-1,!1,((e,t,s)=>{switch(t){case"style":case"icons":e=!1!==e&&!1===/[a-z0-9_-]+/gi.test(e)?s[t]:e;break;case"dirUri":e=!1===/[^<>\?=&#]+/gi.test(e)?s[t]:e;break}return e})),e.barArgs=Jbbed.compare(e.barArgs,t.barArgs,-1,!1,((e,t,s)=>{switch(t){case"keepDefault":case"tiny":e=Boolean(e);break;case"selectiveRemove":0!==e.length&&Array.isArray(e)||(e=s[t]);break}return e})),!0===e.barArgs.tiny)e.bars={1:Jbbed.tinyBar},e.smileys=!1;else{const s=e.barArgs.keepDefault;e.bars=Jbbed.compare(e.bars,t.bars,-1,s)}const s=e.bars;let i=[];for(const[e,t]of Object.entries(s))i=i.concat(Jbbed.explodeString(t,"|"));this.allButtons=i.filter((e=>"#"!==e)),e.single=Jbbed.explodeString(e.single,"|"),Array.isArray(e.single)?e.single=t.single.concat(e.single):e.single=t.single,e.modalArgs=Jbbed.compare(e.modalArgs,t.modalArgs,-1,!1,((e,t,s)=>{switch(t){case"preview":case"palette":case"keepDefault":e=Boolean(e);break;case"previewSentence":"string"==typeof e&&0!==e.length||(e=s[t]);break;case"previewColor":case"previewTextColor":"theme"!==e&&!1===/(#[a-fA-F0-9]{6})/gi.test(e)&&(e=s[t]);break}return e})),e.modal=Jbbed.explodeString(e.modal,"|");!0===e.modalArgs.keepDefault&&(e.modal=t.modal.concat(e.modal)),e.select=Jbbed.compare(e.select,t.select);for(let[s,i]of Object.entries(e.video)){"string"==typeof i&&i.indexOf("|")>-1&&(e.video[s]=explodeString(i,"|")),Array.isArray(i)||(i=[i]),e.video[s]=i.filter((e=>""!==e));for(const i in t.video[s])void 0===e.video[s][i]?e.video[s].push(t.video[s][i]):e.video[s][i]=Jbbed.intVal(e.video[s][i])}Jbbed.sizeUnits.includes(e.sizeUnit)||(e.sizeUnit=t.sizeUnit),e.tagTranslate=Jbbed.compare(e.tagTranslate,t.tagTranslate,2,!1,((e,t,s)=>{if(0!==e.length&&Array.isArray(e)){switch(e.length){case 1:e.push("","");break;case 2:e.push("");break}return e}return s.hasOwnProperty(t)?s[t]:["","",""]})),e.textareaArgs=Jbbed.compare(e.textareaArgs,t.textareaArgs,-1,!1,((e,t,s)=>{switch(t){case"cols":case"rows":e=Jbbed.intVal(e);break;case"width":case"height":!1===/[0-9]+(em|px|pt|vw|%|rem)/gi.test(e)&&(e=s[t]);break;case"indent":e=Boolean(e);break;case"font":"string"!=typeof e&&(e=s[t]);break}return e})),e.previewArgs=Jbbed.compare(e.previewArgs,t.previewArgs,-1,!1,((e,t,s)=>{switch(t){case"width":case"height":!1===/[0-9]+(em|px|pt|vw|%|rem)/gi.test(e)&&(e=s[t]);break;case"contentWrapP":case"noWrapP":case"noTagIntoTag":Array.isArray(e)&&0!==e.length||(e=s[t]);break;case"font":"string"!=typeof e&&(e=s[t]);break;case"show":e=Boolean(e);break}return e})),e.spoilerArgs=Jbbed.compare(e.spoilerArgs,t.spoilerArgs,-1,!1,((e,t,s)=>{switch(t){case"className":e.length>0&&!1===/[a-z0-9\s_-]+/gi.test(e)&&(e=s[t]);break;case"buttonHide":case"buttonShow":0!==e.length&&!1!==/[^<>]+/gi.test(e)||(e=s[t]);break;case"slide":e=Jbbed.intVal(e);break}return e})),0===e.spoilerArgs.className.length&&(e.tagTranslate.spoiler[1]=e.tagTranslate.spoiler[1]+' class="'+e.editorID+'-spoiler"',e.spoilerArgs.className=e.editorID+"-spoiler"),e.jsfPlay=Jbbed.compare(e.jsfPlay,t.jsfPlay,-1,!1,((e,t,s)=>"string"!=typeof e?s[t]:e)),e.smileys=Boolean(e.smileys),e.fullscreen=Boolean(e.fullscreen),e.localizeButtons=Jbbed.compare(e.localizeButtons,t.localizeButtons,2,!1,((e,t,s)=>{if(0!==e.length&&Array.isArray(e)){switch(e.length){case 1:e.push("","");break;case 2:e.push("");break}return e}e=s.hasOwnProperty(t)?s[t]:["","",""]})),e.localizeMessages=Jbbed.compare(e.localizeMessages,t.localizeMessages,2,!1,((e,t,s)=>"string"!=typeof e?s[t]:e)),this.params=e}loadTheme(){const e=this.params.themeArgs.style,t=this.params.themeArgs.dirUri,s=Jbbed.createElement("link",{href:t+"themes/"+e+".css",rel:"stylesheet"});!1!==e&&(this.styleTheme=s)}loadIcons(){const e=this.params.themeArgs.icons,t=this.params.themeArgs.dirUri,s=Jbbed.createElement("link",{href:t+"themes/icons/"+e+".css",rel:"stylesheet"});!1!==e&&(this.styleIcons=s)}allowedTags(){const e=Jbbed.explodeString(this.allButtons,"|"),t=Jbbed.explodeString(this.params.barArgs.selectiveRemove,"|"),s=[];for(const i in e)t.includes(e[i])||s.push(e[i]);this.allowed=s}localizeButtons(e){const t=this.params.localizeButtons;e="object"==typeof t[e]&&t[e].length>0?t[e]:["label:"+e,"title:"+e,"className:"];let s={},i=["label","title","className"];for(const t in e)if(e[t].indexOf(":")>-1){const i=e[t].split(":",2);s[i[0]]=i[1]}else s[i[t]]="";this.buttonLocalized=s}dialogModal(e){const t=this.ID,s=e.attr("data-button"),i="#"+e.attr("id"),a=this.params.select,l=Object.getOwnPropertyNames(this.params.select),n=this.params.modalArgs,r=this.params.localizeButtons,o=this.params.localizeMessages,c=this.params.sizeUnit,d=this.params.smileys,b=this.params.video,p=t+"-d";let h="url",m={};if(h="smileys"===s&&!1!==d?"smileys":h,l.includes(s)){h="color"===s?"color":"select";const e=Jbbed.explodeString(a[s],"|");for(const t in e)if(e[t].toString().indexOf(":")>-1){const s=e[t].toString().split(":"),i=s[1],a=s[0];"color"===h?m["p"+i.substring(1)]=i:m[i]=a}else{const i="size"===s&&"number"==typeof e[t]&&e[t]>0?c:"",a=e[t]+i;m[a]=a}}if(void 0===s||void 0===i||void 0===h||"object"!=typeof m)return!1;$(".jbbed-dialog").remove();const u=document.getElementById(i.substring(1)).getBoundingClientRect().left;let g=[];"theme"!==n.previewBgColor&&g.push("backgroundColor:"+n.previewBgColor),"theme"!==n.previewTextColor&&g.push("color:"+n.previewTextColor);const f=Jbbed.createElement("div",{id:s+"-dialog-"+t,cls:"dialog-"+t+" jbbed-dialog "+p,css:["left:"+u+"px"]}),v=Jbbed.createElement("div",{id:s+"-input-"+t,cls:"jbbed-dialog-input "+p}),y=Jbbed.createElement("div",{id:s+"-buttons-"+t,cls:"jbbed-dialog-buttons "+p}),j=Jbbed.createElement("div",{id:s+"-preview-"+t,cls:"jbbed-dialog-preview "+p,css:g});$(f).insertAfter(i),$("#"+f.id).append([v,y]),!0===n.preview&&($("#"+f.id).append(j),"url"!==h?$("#"+j.id).text(n.previewSentence):$("#"+j.id).hide());const w=[],A=[],k=[],J=[];for(let e=0;e<2;e++){let t="ok";switch(e){case 0:t="ok";break;case 1:t="no";break}this.localizeButtons(t),w[e]=this.buttonLocalized,A[e]=w[e].label.length>0?Jbbed.underscore(w[e].label):t.toUpperCase(),k[e]=w[e].className.length>0?" "+w[e].className:"",J[e]=w[e].title.length>0?w[e].title:""}const x=Jbbed.createElement("button",{id:s+"-ok-"+t,cls:"jbbed-ok button-action-"+t+" "+p+k[0],data:["data-button:"+s,"data-value:"],type:"button",title:J[0],textContent:A[0]}),C=Jbbed.createElement("button",{id:s+"-no-"+t,cls:"jbbed-no "+p+k[1],textContent:A[1],title:J[1],type:"button"});$("#"+y.id).append([C,x]),$(document).on("click","#"+x.id,(function(){$(f).remove()})),$(document).on("click","#"+C.id,(function(){return $(f).remove(),!1}));let E="";if(void 0!==o[s]){let e=Object.keys(b).join(", ").trim(",");E=o[s].replace("$1",e)}switch(h){case"url":const i=Jbbed.createElement("label",{textContent:E,cls:"dialog-label-"+t+" jbbed-dialog-label "+p,htmlFor:s+"-field-"+t}),a=Jbbed.createElement("input",{id:s+"-field-"+t,cls:"jbbed-input-field "+p,value:"",type:h});$("#"+v.id).append([i,a]),$(document).on("keyup","#"+a.id,(function(e){let t=$(this).val();if($("#"+x.id).attr("data-value",t),!0===n.preview){switch($("#"+j.id).html(""),s){case"img":const e=Jbbed.createElement("img",{src:t});$("#"+j.id).html(e).show();break;case"vid":t=Jbbed.buildVid(t,b),$("#"+j.id).html(t).show();break}0===t.length&&$("#"+j.id).html("")}}));break;case"select":const l=Jbbed.createElement("label",{textContent:r[s][0].split(":")[1].replace(/^_/,""),cls:"dialog-label-sel-"+t+" jbbed-dialog-label-sel "+p,htmlFor:s+"-select-"+t}),o=Jbbed.createElement("select",{id:s+"-select-"+t,cls:"jbbed-select "+p,value:m});$("#"+v.id).append([l,o]),$(document).on("change","#"+o.id,(function(){let e=$(this).val();if($("#"+x.id).attr("data-value",e),!0===n.preview)switch(s){case"size":$("#"+j.id).css("font-size",e);break;case"font":$("#"+j.id).css("font-family",e);break;case"h":let t=$("#"+j.id).text();if(0===e.length||"--"===e)return $("#"+j.id).text(t),!1;e="h"===s?"h"+e:e,$("#"+j.id).text("");let i=Jbbed.createElement(e);i.append(t),$("#"+j.id).append(i);break}}));break;case"color":const c=!0===n.palette?" jbbed-full-palette":" jbbed-custom-palette",d=Jbbed.createElement("div",{id:s+"-list-"+t,cls:"jbbed-"+s+"-list"+c+" "+p}),u=Jbbed.createElement("input",{type:"hidden",id:s+"-selected-"+t+" "+p});$("#"+v.id).append([d,u]);const g=!0===n.palette?Jbbed.colorPalette():m,y=s+"-item-"+t;for(const i in g){const a=Jbbed.createElement("span",{id:s+"-"+i+"-"+t,cls:"jbbed-color "+y+" "+p,data:"data-value:"+g[i],css:"backgroundColor:"+g[i]});$(d).append(a);let l=$("#"+e.attr("id")).attr("data-checked");$("#"+l).addClass("checked")}$(document).on("click","."+y,(function(){$("."+y).removeClass("checked"),$(this).addClass("checked");let t=$(this).attr("data-value");$("#"+e.attr("id")).attr("data-checked",$(this).attr("id")),$(u.id).val(t),$("#"+x.id).attr("data-value",t),!0===n.preview&&$("#"+j.id).css("color",t)}));break;case"smileys":const w=Jbbed.createElement("div",{id:s+"-list-"+t,cls:"jbbed-"+s+"-list "+p}),A=Jbbed.createElement("input",{type:"hidden",id:s+"-selected-"+t+" "+p}),k=Jbbed.createElement("button",{id:"del-"+t,cls:"jbbed-del "+p,type:"button"}),J=Jbbed.createElement("div",{cls:"jbbed-wrap-del-preview "+p});$(f).append(J),$(J).append([j,k]);let C=this.params.smileys,N="boolean"!=typeof C?Jbbed.explodeString(C,"|"):C;C=Jbbed.getSmileys(N);const S=s+"-item-"+t;for(const e in C){const i=C[e].slice(2,-1),a=Jbbed.createElement("button",{id:s+"-"+i+"-"+t,cls:"jbbed-button jbbed-smileys "+S+" "+p,type:"button",data:"data-value:"+C[e],htmlContent:C[e]});$(w).append(a)}$("#"+v.id).append([w,A]),$(k).insertBefore(j),$(document).on("click","."+S,(function(e){let t=$(this).attr("data-value"),s=$(A).val();$("#"+x.id).attr("data-value",s+t),$(A).val(s+t),!0===n.preview&&$(j).html(s+t)})),$(j).text(""),$(document).on("click","#"+k.id,(function(e){let t=$(A).val();t=t.substring(0,t.length-9),$("#"+x.id).attr("data-value",t),$(A).val(t),$(j).html(t)}));break;default:return!1}}buttons(){const e=this.ID,t=this,s=this.params.bars,i=Object.getOwnPropertyNames(this.params.select),a=this.params.select,l=this.allowed,n=this.params.smileys,r=this.params.modal,o=this.frame.buttons;l.push("#");let c=0;for(let t in s){if(0===s[t].length)continue;const d=Jbbed.explodeString(s[t],"|"),b=0===c?" jbbed-first-bar":"",p=c===Object.entries(s).length?"jbbed-last-bar":"";c++;const h=Jbbed.createElement("div",{cls:"bar-"+e+" jbbed-bar jbbed-bar-"+t+b+p});$("#"+o.id).append(h);for(let t in d){if(!l.includes(d[t]))continue;if(!1===n&&"smileys"===d[t])continue;if("#"===d[t]){const t=Jbbed.createElement("span",{cls:"sep-"+e+" jbbed-sep"});$(h).append(t);continue}this.localizeButtons(d[t]);const s=this.buttonLocalized,o=s.label.length>0?Jbbed.underscore(s.label):d[t],c=s.className.length>0?" "+s.className:"",b=s.title.length>0?s.title:"";if(i.includes(d[t])&&!r.includes(d[t])){const s=Jbbed.explodeString(a[d[t]],"|"),i=Jbbed.createElement("label",{cls:"jbbed-label"+c,textContent:o}),l=Jbbed.createElement("select",{cls:"button-select-"+e+" jbbed-button-select select-action-"+e+" "+d[t]+"-button",data:"data-button:"+d[t],value:s});$(h).append(i),$(i).append(l)}else{switch(d[t]){case"link":r.push(d[t]);break;case"img":r.push(d[t]);break;case"vid":r.push(d[t]);break;case"smileys":r.push(d[t]);break;case"jsf":r.push(d[t]);break}let s=r.includes(d[t])?"modal-action-"+e+" ":"button-action-"+e+" ";const i=Jbbed.createElement("button",{title:b,id:d[t]+"-button-"+e,cls:"button-"+e+" jbbed-button "+s+d[t]+"-button"+c,textContent:o,type:"button",data:"data-button:"+d[t]});$(h).append(i)}}}$(".sep-"+e).each((function(){0===$(this).next().length&&$(this).remove()})),$(".bar-"+e).each((function(){$(this).is(":empty")&&$(this).remove()})),$(document).on("click",".modal-action-"+e,(function(){t.dialogModal($(this))})),$("html").on("click",(function(t){t.target.classList.contains(e+"-d")||$(".dialog-"+e).remove()}))}fullscreen(){const e=this.ID,t=this.frame.fullscreen,s=this.frame.buttons,i=this.frame.main,a=this.frame.preview,l=this.editor[0],n=this.frame.tab,r=!1===this.params.previewArgs.show?" no-show-preview":"",o=this.params.textareaArgs.height,c=this.params.previewArgs.height;this.localizeButtons("fullscreen");const d=this.buttonLocalized,b=d.label.length>0?Jbbed.underscore(d.label):"Fullscreen",p=d.className.length>0?" "+d.className:"",h=d.title.length>0?d.title:"";$(t).insertAfter(s);const m=Jbbed.createElement("button",{id:"fullscreen-button-"+e,cls:"jbbed-fullscreen-button"+p+r,title:h,type:"button",textContent:b});$(t).append(m),$("#"+m.id).on("click",(function(){const e="#"+i.id,r=s.offsetHeight+n.offsetHeight+t.offsetHeight,d=window.innerHeight-(r+r/3);$(e).hasClass("jbbed-fullscreen")?($(e).removeClass("jbbed-fullscreen"),$(this).removeClass("fullscreen-active"),$("#"+a.id).css("height",c),$("#"+l.id).css("height",o)):($(e).addClass("jbbed-fullscreen"),$("#"+a.id).css("height",d+"px"),$("#"+l.id).css("height",d+"px"),$(this).addClass("fullscreen-active"))}))}doBBCode(e){const t=this.editor,s=this.params.modal,i=Object.getOwnPropertyNames(this.params.select),a=this.params.single,l=this.params.sizeUnit,n=(this.params.tagTranslate,this.params.localizeMessages),r=this.allowed;let o=e.attr("data-smileys"),c=e.attr("data-button");if(""===c||!r.includes(c))return!1;if("clear"===c){if(0!==t.val().length)return!!confirm(n.clear)&&(t.val(""),!1);c=""}const d=t.attr("data-start"),b=t.attr("data-end"),p=t.val().substring(d,b),h=Jbbed.explodeString(s,"|");let m="";if(h.includes(c)&&(m=e.attr("data-value")),h.includes(c)&&(null==m||"undefined"===m))return!1;if(h.includes(c)&&""===m.trim())return!1;if(m=!0===Jbbed.testEmail(m)&&"link"===c?"mailto:"+m:m,m=h.includes(c)&&"smileys"!==c&&"h"!==c?"="+m:m,o=h.includes(c)&&"smileys"===c?m:o,i.includes(c)&&!h.includes(c)){let t=e.val().trim();if(m=t.length>0&&("h"!==c?"=":"")+t+("size"===c?l:""),!1===m)return!1}let u="["+c+m+"]"+p+"[/"+c+("h"===c?m:"")+"]",g="["+c+m+"][/"+c+"]";Jbbed.explodeString(a,"|").includes(c)&&("smileys"!==c?(u=p+"["+c+m+"]",g="["+c+m+"]"):(u=p+o,g=u));const f=t.val().substring(0,d)+u+t.val().substring(b);t.val(f),t[0].selectionEnd=+b+g.length,t[0].focus({preventScroll:!0})}textarea(){const e=this,t=this.ID,s=this.editor,i=this.params.textareaArgs.indent,a=this.params.textareaArgs;Jbbed.addProp(s,a),Jbbed.textareaIndent(s.attr("id"),i),s.attr("data-start",0),s.attr("data-end",0),s.on("select click keyup keydown tap",(function(){const e=$(this)[0].selectionStart,t=$(this)[0].selectionEnd;$(this).attr("data-start",e),$(this).attr("data-end",t)})),$(document).on("click",".button-action-"+t,(function(){e.doBBCode($(this))})),$(document).on("change",".select-action-"+t,(function(){e.doBBCode($(this))}))}spoiler(){const e=this.ID,t=this.params.spoilerArgs.className,s=this.params.spoilerArgs.buttonHide,i=this.params.spoilerArgs.buttonShow,a=this.params.spoilerArgs.slide,l=Jbbed.createElement("div",{cls:"jbbed-spoiler-container"}),n=Jbbed.createElement("button",{textContent:i,cls:"button-spoiler-"+e+" jbbed-button-spoiler",type:"button"});Jbbed.createElement("p");$("."+t).wrap(l),$(n).insertAfter("."+t);$(".button-spoiler-"+e).on("click",(function(){const e=$(this);e.prev().toggle(a,(function(){$(this).is(":hidden")?e.text(i):e.text(s)}))}))}jsf(){const e=this.params.jsfPlay,t=this.frame.preview.id,s=$("#"+t);let i="";"all"!==e.output&&(i=Jbbed.explodeString(e.output,"|"),i=i.join(",")+"/");let a="";e.theme.length>0&&(a=e.theme);const l=s[0].getElementsByClassName("jsfiddle-snippet");for(const e of l){const t=e.getAttribute("data-src"),s=Jbbed.createElement("script",{src:t+"embed/"+i+a,async:!0});e.append(s)}}doHtml(){const e=this.frame.preview,t=this.allowed.join("|"),s=this.params.tagTranslate,i=this.editor.val(),a=this.params.previewArgs.contentWrapP,l=this.params.previewArgs.noWrapP,n=this.params.previewArgs.noTagIntoTag;let r=i;const o=r.matchAll(/\[code\](.*?)\[\/code\]/gms);for(const e of o){const t="[code]"+btoa(e[1])+"[/code]";r=r.replace(e[0],t)}if(r=r.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t.toString().trim().length>0){const e=new RegExp("\\[\\/?("+t+")\\s*(.*?)\\]","gm"),s=r.match(e);for(const e in s){const t=s[e].slice(1,-1);r=r.replace("["+t+"]","###"+t+"###")}r=r.replace(/\[(\/?[a-z0-9]+)(=(.*?))?\]/g,"").replace(/\/?###(.*?)###/g,"[$1]")}for(let[e,t]of Object.entries(s)){if(!1===t)continue;t=Jbbed.explodeString(t,"|",3);const s=t[0].trim(),i=t[1].trim();let a=".*?";if(t[2].trim().length>0&&(a=t[2].trim()),0===i.length){r=r.replaceAll("["+e+"]","<"+s+">").replaceAll("[/"+e+"]","</"+s+">");continue}if(i.length>0&&-1===i.indexOf("$1")){r=r.replaceAll("["+e+"]","<"+s+" "+i+">").replaceAll("[/"+e+"]","</"+s+">");continue}const l=new RegExp("\\[("+e+")=("+a+")\\]","gmi"),n=r.matchAll(l);for(const t of n){const a=t[0].slice(1,-1),l=t[2];let n=s,o=n+" "+i.replace("$1",l),c=n;r=r.replace("["+a+"]","<"+o+">").replace("[/"+e+"]","</"+c+">")}}const c=r.matchAll(/\[vid=([^<>\]\[\s]+)\]/g);for(const e of c)this.buildVid(e[1]),r=r.replace(e[0],this.video);const d=r.matchAll(/\[jsf=([^<>\]\[\s]+)\]/g);for(const e of d){const t=Math.random(),s=Jbbed.randomId(t,5);!0===/(\/\/)?(www\.)?jsfiddle\.net/g.test(e[1])&&(r=r.replace(e[0],Jbbed.createElement("span",{id:"jsf-"+s,cls:"jsfiddle-snippet",data:"data-src:"+e[1].replace(/http(s):?/g,"")},!0)))}r=r.replace(/\[(\/?[a-z0-9]+)(=(.*?))?\]/g,"<$1$2>"),r=r.replace(/<\/?p>/gm,"");const b=new RegExp("<p>(<("+l.join("|")+")([^>]+)?>(.*?)(<\\/("+l.join("|")+")>)?)<\\/p>","gms");r=r.replace(/\n|\r|\r\n/gm,"</p><p>").replace(/<p><\/p>/gms,"").replace(b,"$1"),r="<p>"+r+"</p>";const p=r.matchAll(/<pre(\s+[^>]+)?>(.*?)<\/pre>/gms);for(const e of p){let t=void 0!==e[1]?e[1]:"",s=atob(e[2]);s=s.replaceAll("<","&lt;").replace(">","&gt;");let i=s.split("\n");const a=[];for(let e=0;e<i.length;e++)a[e]="<li><code>"+i[e]+"</code></li>";const l="<pre"+t+"><ol>"+a.join("")+"</ol></pre>";r=r.replace(e[0],l)}$("#"+e.id).html(r);for(const t of e.children){const e=t.tagName.toLowerCase();"<p></p>"===t.outerHTML&&(t.outerHTML="");for(let e of t.children)Jbbed.removeTagIntoTag(e,n);a.includes(e)&&t.innerHTML.indexOf("<p>")>-1&&(t.innerHTML="<p>"+t.innerHTML),l.includes(e)&&(t.innerHTML=t.innerHTML.replace(/(<\/?p>|<br>)+/gms,""))}this.spoiler(),this.jsf()}preview(){const e=this.ID,t=this,s=this.editor,i=this.frame.preview,a=this.params.previewArgs,l=this.params.previewArgs.show,n=[],r=[],o=[],c=[],d=this.frame.tab,b=[],p="tabbed-"+e,h=["edit","preview"];if(!1===l)return!1;for(const t in h){let s="";switch(h[t]){case"edit":s=" active jbbed-tab-edit "+p;break;case"preview":s=" jbbed-tab-preview "+p;break}let i=h[t].substring(0,1).toUpperCase()+h[t].substring(1);this.localizeButtons(h[t]),n[t]=this.buttonLocalized,r[t]=n[t].label.length>0?Jbbed.underscore(n[t].label):i,o[t]=n[t].className.length>0?" "+n[t].className:"",c[t]=n[t].title.length>0?n[t].title:"",b[t]=Jbbed.createElement("li",{title:c[t],id:h[t]+"-"+e,cls:"tab "+h[t]+s+o[t]})}$(d).append(b),$(d).insertBefore(s);const m=$("."+p),u=$("#"+i.id),g=Jbbed.createElement("div",{cls:"jbbed-wrapper-tab",id:"wrapper-tab-"+e});s.wrap(g),s.parent().append(u),Jbbed.addProp(u,a),u.html(""),$(m).on("click",(function(){s.parent().prev().children("li").removeClass("active"),$(this).addClass("active"),$(this).hasClass("edit")?($(".button-"+e).removeClass("jbbed-disabled").prop("disabled",!1),s.show(),u.hide(),u.html("")):(s.hide(),$(".button-"+e).addClass("jbbed-disabled").prop("disabled",!0),t.doHtml(),u.show())}))}buildVid(e){const t=this.params.video.youtube,s=this.params.video.rumble;if(0===e.trim().length||void 0===e||"null"===e)return;let i="";const a=new URL(e),l=/(www\.)?youtu(\.)?be(\.com)?/g.test(e),n=/(www\.)?rumble\.com/g.test(e);if(!0===l&&void 0!==t){let e=a.searchParams.get("v");if(null==e&&(e=a.pathname.slice(1)),"null"===e||void 0===e)return;e.search("embed")>-1&&(e=e.substring(6));const s=Jbbed.explodeString(t,"|");i='<iframe width="'+s[0]+'" height="'+s[1]+'" src="'+("https://www.youtube"+(0===Jbbed.intVal(s[2])?"":"-nocookie")+".com/embed/"+e+"?controls=1")+'" title="Youtube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>'}else if(!0===n&&void 0!==s){let e=a.pathname.slice(7,-1);if("null"===e||void 0===e)return;const t=Jbbed.explodeString(s,"|");i='<iframe class="rumble" width="'+t[0]+'" height="'+t[1]+'" src="'+("https://rumble.com/embed/"+e+"/?pub=4")+'" frameborder="0" allowfullscreen></iframe>'}this.video=i}static compare(e,t,s=-1,i=!1,a){for(const[s,a]of Object.entries(t))void 0===e[s]?e[s]=a:!0===i&&(e[s]=a.concat(e[s]));for(const[i,l]of Object.entries(e))"string"==typeof l&&(e[i]=Jbbed.explodeString(l,"|",s,"")),a&&(e[i]=a(l,i,t));return e}static createElement(e,t={},s=!1,i=!1){const a=document.createElement(e);if(void 0!==t.id&&(a.id=t.id),void 0!==t.cls&&(a.className=t.cls),void 0!==t.type&&(a.type=t.type),void 0!==t.name&&(a.name=t.name),void 0!==t.src&&(a.src=t.src),void 0!==t.href&&(a.href=t.href),void 0!==t.title&&(a.title=t.title),void 0!==t.for&&(a.for=t.for),void 0!==t.textContent&&(a.textContent=t.textContent),void 0!==t.htmlContent&&(a.innerHTML=t.htmlContent),void 0!==t.target&&(a.target=t.target),void 0!==t.htmlFor&&(a.htmlFor=t.htmlFor),void 0!==t.rel&&(a.rel=t.rel),!0===t.async&&a.setAttribute("async",""),"select"===e&&"object"==typeof t.value)for(const e in t.value){const s=document.createElement("option");s.value="0"==t.value[e]||"--"==t.value[e]?"":e,s.textContent=t.value[e],t.value[e].toString().indexOf(":")>-1&&(t.value[e]=t.value[e].split(":"),s.textContent=t.value[e][0],s.value="0"===t.value[e][1]||"--"==t.value[e]?"":t.value[e][1]),a.appendChild(s)}else void 0!==t.value&&(a.value=t.value);const l=t.css;if("object"==typeof t.css)for(const e in l){if(l[e].indexOf(":")<1)continue;const t=l[e].split(":");a.style[t[0]]=t[1]}else if("string"==typeof l&&l.indexOf(":")>0){const e=l.split(":");a.style[e[0]]=e[1]}const n=t.data;if("object"==typeof n)for(const e in n){if(n[e].indexOf(":")<1)continue;const t=Jbbed.cutString(n[e],":",1);a.setAttribute(t[0],t[1])}else if("string"==typeof n&&n.indexOf(":")>0){const e=Jbbed.cutString(n,":",1);a.setAttribute(e[0],e[1])}return!0===s?!0===i?a.innerHTML:a.outerHTML:a}static parseIntArr(e){return Array.isArray(e)?e.map((function(e){return isNaN(1*e)?e:parseInt(e)})):e}static addProp(e,t){if(void 0!==e[0]&&null!=e)for(const s in t)if(void 0!==t[s]&&0!==t[s].length){let i=e[0].className;switch(s){case"font":e[0].style.fontFamily=t[s];break;case"width":e[0].style.width=t[s];break;case"height":e[0].style.height=t[s];break;case"indent":e[0].style.className=i+" has-indent";break}}}static testEmail(e){return/[a-zA-Z0-9-_|#$%&'\/=^`{}~]+@[a-zA-Z0-9\.]+/gm.test(e)}static randomId(e,t,i=0){const a=(e*Math.random()).toString(36),l=(Date.now()*Math.random()).toString(36);let n=Math.random().toString(36)+a+l;if(0===Jbbed.intVal(i))return n.substring(1,t+2).replace(/\./g,"");{let e=[],a=n.charCodeAt(0)*s*Math.random();for(let s=0;s<Jbbed.intVal(i);s++)e[s]=randomId(a,t,0);return n=e[Math.floor(Math.random()*e.length)],n=n.substring(1,t+2).replace(/\./g,""),n}}static textareaIndent(e,t){document.getElementById(e).addEventListener("keydown",(function(e){if("Tab"==e.key&&!0===t){e.preventDefault();const t=this.selectionStart,s=this.selectionEnd;this.value=this.value.substring(0,t)+"\t"+this.value.substring(s),this.selectionStart=this.selectionEnd=t+1}}))}static hsl2hex(e,t,s,i){s/=100;const a=t*Math.min(s,1-s)/100,l=function(t){const i=(t+e/30)%12,l=s-a*Math.max(Math.min(i-3,9-i,1),-1);return Math.round(255*l).toString(16).padStart(2,"0")};return"ff"===(i=Math.round(255*i).toString(16).padStart(2,"0"))&&(i=""),`#${l(0)}${l(8)}${l(4)}${i}`}static colorPalette(e=100,t=85,s=1,i={}){const a=[];for(let i=1;i<=10;i++)Array(360).fill(0).forEach((function(l,n){const r=Jbbed.hsl2hex(n,e,t/i,s);a["p"+r.substring(1)]=r}));t=100;const l=[];Array(360).fill(0).forEach((function(e,i){if(t>-1){const e=Jbbed.hsl2hex(i,0,t,s);t--,l["p"+e.substring(1)]=e}}));const n=Object.assign(a,l);if(Object.entries(i).length>0){let e={};for(let t in n)void 0!==i[t]&&(e[t]=n[t]);return e}return n}static filterColors(e={}){return Jbbed.colorPalette(100,50,1,e)}static cutString(e,t,s,i=!1){const a=e.split(t,s),l=a.join(t),n=e.substring(l.length+t.length);return 0===n.length?a:!0===i?[l,n]:a.concat(n)}static explodeString(e,t,s,i=[]){return"string"==typeof e?e.indexOf(t)?Jbbed.cutString(e.trim(),t,s):i:e}static arrayRange(e,t){const s=[];return Array(t-e+1).fill(0).forEach((function(t,i){s[i]=e+i})),s}static getSmileys(e=[],t=!1){e=Jbbed.explodeString(e,"|");const s=[];let i=0,a=Jbbed.arrayRange(128512,128567);for(let l in a){let n=!1===t?"&#"+a[l]+";":all[l];Array.isArray(e)&&e.length>0?e.includes(n)&&(s[+i]=n):s[+i]=n,i++}return s}static removeTagIntoTag(e,t=[]){for(const s of e.children){let i=s.tagName.toLowerCase(),a=new RegExp("<\\/?"+i+">","gsm");t.includes(i)&&(e.innerHTML=e.innerHTML.replace(a,""))}}static intVal(e){return e=parseInt(e),isNaN(e)?0:e}static getDisplayEl(e,t="block"){const s=document.createElement(e);s.style.position="absolute",s.style.left="-9999px",document.body.appendChild(s);const i=window.getComputedStyle(s).getPropertyValue("display");return document.body.removeChild(s),i===t}static underscore(e){return 0===e.indexOf("_")?"":e}}